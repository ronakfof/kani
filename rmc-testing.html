<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Testing - The Rust Model Checker</title>
                

        <!-- Custom HTML head -->
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="Documentation for the Rust Model Checker (RMC)">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

                <link rel="icon" href="favicon.svg">
                        <link rel="shortcut icon" href="favicon.png">
                <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
                <link rel="stylesheet" href="css/print.css" media="print">
        
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
                <link rel="stylesheet" href="fonts/fonts.css">
        
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
            </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="getting-started.html"><strong aria-hidden="true">1.</strong> Getting started with RMC</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="install-guide.html"><strong aria-hidden="true">1.1.</strong> Installation</a></li><li class="chapter-item expanded "><a href="tool-comparison.html"><strong aria-hidden="true">1.2.</strong> Comparison with other tools</a></li><li class="chapter-item expanded "><a href="rmc-single-file.html"><strong aria-hidden="true">1.3.</strong> RMC on a single file</a></li><li class="chapter-item expanded "><a href="cargo-rmc.html"><strong aria-hidden="true">1.4.</strong> RMC on a package</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">1.5.</strong> Debugging failures</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">1.6.</strong> Debugging non-termination</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">1.7.</strong> Debugging coverage</div></li></ol></li><li class="chapter-item expanded "><a href="rmc-tutorial.html"><strong aria-hidden="true">2.</strong> RMC tutorial</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="tutorial-first-steps.html"><strong aria-hidden="true">2.1.</strong> First steps with RMC</a></li><li class="chapter-item expanded "><a href="tutorial-kinds-of-failure.html"><strong aria-hidden="true">2.2.</strong> Failures that RMC can spot</a></li><li class="chapter-item expanded "><a href="tutorial-loops-unwinding.html"><strong aria-hidden="true">2.3.</strong> Loops, unwinding, and bounds</a></li><li class="chapter-item expanded "><a href="tutorial-real-code.html"><strong aria-hidden="true">2.4.</strong> Where to start on real code</a></li></ol></li><li class="chapter-item expanded "><a href="dev-documentation.html"><strong aria-hidden="true">3.</strong> RMC developer documentation</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="rmc-testing.html" class="active"><strong aria-hidden="true">3.1.</strong> Testing</a></li></ol></li><li class="chapter-item expanded "><a href="dashboard.html"><strong aria-hidden="true">4.</strong> RMC dashboard</a></li></ol>            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                                                <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                                            </div>

                    <h1 class="menu-title">The Rust Model Checker</h1>

                    <div class="right-buttons">
                                                <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                                                                        <a href="https://github.com/model-checking/rmc" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                                                                        <a href="https://github.com/model-checking/rmc/edit/main/rmc-docs/src/rmc-testing.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>
                        
                    </div>
                </div>

                                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="testing"><a class="header" href="#testing">Testing</a></h1>
<p>Testing in RMC is carried out in multiple ways. There are at least
two very good reasons to do it:</p>
<ol>
<li>
<p><strong>Software regression</strong>: A regression is a type of bug
that appears after a change is introduced where a feature that
was previously working has unexpectedly stopped working.</p>
<p>Regression testing allows one to prevent a software regression
from happening by running a comprehensive set of working tests
before any change is committed to the project.</p>
</li>
<li>
<p><strong>Software metrics</strong>: A metric is a measure of software
characteristics which are quantitative and countable. Metrics are
particularly valuable for project management purposes.</p>
</li>
</ol>
<p>We recommend reading our section on <a href="#regression-testing">Regression Testing</a>
if you are interested in RMC development. At present, we obtain metrics based
on the <a href="./dashboard.html">RMC dashboard</a>.</p>
<h1 id="regression-testing"><a class="header" href="#regression-testing">Regression testing</a></h1>
<p>RMC relies on a quite extensive range of tests to perform regression testing.
Regression testing can be executed by running the command:</p>
<pre><code>./scripts/rmc-regression.sh
</code></pre>
<p>The <code>rmc-regression.sh</code> script executes different testing commands, which we classify into:</p>
<ul>
<li><a href="#rmc-testing-suites">RMC testing suites</a></li>
<li><a href="#rust-unit-tests">Rust unit tests</a></li>
<li><a href="#script-based-tests">Script-based tests</a></li>
</ul>
<p>See below for a description of each one.</p>
<p>Note that regression testing is run whenever a Pull Request is opened, updated or merged
into the main branch. Therefore, it is a good idea to run regression testing locally before
submitting a Pull Request for RMC.</p>
<h2 id="rmc-testing-suites"><a class="header" href="#rmc-testing-suites">RMC testing suites</a></h2>
<p>The RMC testing suites are the main testing resource for RMC. In most cases, the
tests contained in the RMC testing suites are single Rust files that are run
using the following command:</p>
<pre><code>rmc file.rs &lt;options&gt;
</code></pre>
<p>Command-line options <code>&lt;options&gt;</code> can be passed to the test by adding a special
comment to the file.
Read more about it in the <a href="#testing-options">Testingoptions</a> section.</p>
<p>In particular, the RMC testing suites are composed of:</p>
<ul>
<li><code>rmc</code>: The main testing suite for RMC. The test is a single Rust file that is
run through RMC. In general, the test passes if verification with RMC
is successful, otherwise it fails.</li>
<li><code>firecracker</code>: Works like <code>rmc</code> but contains tests inspired by
<a href="https://github.com/firecracker-microvm/firecracker">Firecracker</a> code.</li>
<li><code>prusti</code>: Works like <code>rmc</code> but contains tests from the
<a href="https://github.com/viperproject/prusti-dev">Prusti</a> tool.</li>
<li><code>smack</code>: Works like <code>rmc</code> but contains tests from the
<a href="https://github.com/smackers/smack">SMACK</a> tool.</li>
<li><code>expected</code>: Similar to <code>rmc</code> but with an additional check which ensures that
lines appearing in <code>*.expected</code> files appear in the output
generated by <code>rmc</code>.</li>
<li><code>cargo-rmc</code>: This suite is designed to test the <code>cargo-rmc</code> command. As such,
this suite works with packages instead of single Rust files.
Flags can be specified in the <code>Cargo.toml</code> configuration file.
Similar to the <code>expected</code> suite, we look for <code>*.expected</code> files
for each function under test.</li>
</ul>
<p>We have extended
<a href="https://rustc-dev-guide.rust-lang.org/tests/intro.html"><code>compiletest</code></a> (the
Rust compiler testing framework) to work with these suites. That way, we take
advantage of all <code>compiletest</code> features (e.g., parallel execution).</p>
<h3 id="testing-stages"><a class="header" href="#testing-stages">Testing stages</a></h3>
<p>The process of running single-file tests is split into three stages:</p>
<ul>
<li><code>check</code>: This stage uses the Rust front-end to detect if the example is valid
Rust code.</li>
<li><code>codegen</code>: This stage uses the RMC back-end to determine if we can generate
GotoC code.</li>
<li><code>verify</code>: This stage uses CBMC to obtain a verification result.</li>
</ul>
<p>If a test fails, the error message will include the stage where it failed:</p>
<pre><code>error: test failed: expected check success, got failure
</code></pre>
<p>When working on a test that is expected to fail, there are two options to
indicate an expected failure. The first one is to add a comment</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// rmc-&lt;stage&gt;-fail
<span class="boring">}
</span></code></pre></pre>
<p>at the top of the test file, where <code>&lt;stage&gt;</code> is the stage where the test is
expected to fail.</p>
<p>The other option is to use the predicate <code>rmc::expect_fail(cond, message)</code>
included in the RMC library. The <code>cond</code> in <code>rmc::expect_fail</code> is a condition
that you expect not to hold during verification. The testing framework expects
one <code>EXPECTED FAIL</code> message in the verification output for each use of the
predicate.</p>
<blockquote>
<p><strong>Warning:</strong> Note that <code>rmc::expect_fail</code> is only useful to indicate
failure in the <code>verify</code> stage, errors in other stages will be considered
testing failures.</p>
</blockquote>
<h3 id="testing-options"><a class="header" href="#testing-options">Testing options</a></h3>
<p>Many tests will require passing command-line options to RMC. These options can
be specified in single Rust files by adding a comment at the top of the file:</p>
<pre><code>// rmc-flags: &lt;options&gt;
</code></pre>
<p>For example, to increase the unwinding value to 4 in a test, we can write:</p>
<pre><code>// rmc-flags: --cbmc-args --unwind 4
</code></pre>
<p>Alternatively, CBMC flags can also be passed using <code>cbmc-flags</code>:</p>
<pre><code>// cbmc-flags: --unwind 4
</code></pre>
<blockquote>
<p><strong>Warning:</strong> <code>cbmc-flags</code> is likely to be deprecated in the near future. We
recommend using <code>rmc-flags</code> with <code>--cbmc-args</code> for now.</p>
</blockquote>
<p>For <code>cargo-rmc</code> tests, the preferred way to pass command-line options is adding
them to <code>Cargo.toml</code> below the <code>[rmc.flags]</code> marker.</p>
<h2 id="rust-unit-tests"><a class="header" href="#rust-unit-tests">Rust unit tests</a></h2>
<p>These tests follow the
<a href="https://doc.rust-lang.org/rust-by-example/testing/unit_testing.html">Rust unit testing</a>
style.</p>
<p>At present, RMC only uses unit tests in the
<a href="https://github.com/model-checking/rmc/tree/main/compiler/cbmc">cbmc crate</a>
to test the
<a href="https://github.com/model-checking/rmc/blob/main/compiler/cbmc/src/goto_program/symtab_transformer/identity_transformer.rs">identity symbol table transformer</a>.</p>
<h2 id="script-based-tests"><a class="header" href="#script-based-tests">Script-based tests</a></h2>
<p>These are tests which are run using scripts. Scripting gives us the ability to
perform ad-hoc checks that cannot be done otherwise. They are currently used
for:</p>
<ul>
<li>Standard library codegen</li>
<li>Firecracker virtio codegen</li>
<li>Diamond dependency</li>
<li>Type mismatch</li>
</ul>
<p>In fact, most of them are equivalent to running <code>cargo rmc</code> and performing
checks on the output. The downside to scripting is that these tests will always
be run, even if there have not been any changes since the last time the
regression was run.</p>
<blockquote>
<p><strong>Warning:</strong> <code>cargo rmc</code> is under heavy development at the moment. Because of
that, this section may become outdated soon.</p>
</blockquote>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                                                    <a rel="prev" href="dev-documentation.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        
                                                    <a rel="next" href="dashboard.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                                    <a rel="prev" href="dev-documentation.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                
                                    <a rel="next" href="dashboard.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                            </nav>

        </div>

        
        
        
                <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        
        
                <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
        
    </body>
</html>
